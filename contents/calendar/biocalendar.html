<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>バイオリズム＋月間カレンダー（記号版）</title>
<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0;
}

#controls {
  padding: 10px;
  background: #f0f0f0;
}

#controls button {
  margin-left: 5px;
}

/* タイトルと凡例のエリア */
#info {
  padding: 8px 12px;
  font-size: 18px;
  border-bottom: 1px solid #333;
}

#legend {
  font-size: 14px;
  margin-top: 4px;
}

#biorhythm {
  width: 100%;
  height: 240px;
  border-bottom: 2px solid #333;
}

/* カレンダー全体 */
#calendar {
  width: 100%;
  border-collapse: collapse;
}

/* 曜日行（高さを低く） */
#calendar th {
  border: 1px solid #333;
  height: 28px;
  font-size: 14px;
  background: #fafafa;
}

/* 日付セル（広く） */
#calendar td {
  border: 1px solid #333;
  width: 14.2%;
  height: 95px;
  vertical-align: top;
  padding: 3px;
}

/* 日付の数字（大きく） */
.date-number {
  font-size: 24px;
  font-weight: bold;
}

/* 予定欄 */
#calendar textarea {
  width: 100%;
  height: 55px;
  border: none;
  resize: none;
  font-size: 12px;
}
@media print {
  /* コントロール類は非表示 */
  #controls {
    display: none;
  }

  /* タイトル部分は少し大きく */
  #info {
    font-size: 18px;
    border-bottom: none;
    padding: 4px 8px;
  }

  /* バイオリズム部分を少し縮める */
  #biorhythm {
    height: 28vh;   /* ← 30 → 28 に縮小 */
  }

  /* カレンダー部分を広げる */
  #calendar {
    height: 72vh;
  }

  /* カレンダーのセル高さを印刷時だけ縮める */
  #calendar td {
    height: 70px;   /* ← 95px → 70px に縮小 */
  }

  /* 予定欄も少し縮める */
  #calendar textarea {
    height: 40px;   /* ← 55px → 40px */
  }

  /* 印刷余白を最小化（ブラウザ依存だが効果大） */
  @page {
    margin: 5mm;
  }
}


</style>
</head>
<body>

<div id="controls">
  生年月日: <input type="date" id="birth">
  年: <input type="number" id="year" value="2024" style="width:80px;">
  月: <input type="number" id="month" value="1" style="width:50px;">

  <button onclick="updateAll()">更新</button>
  <!-- 印刷ボタン追加 -->
  <button onclick="printPage()">印刷</button>


</div>

<!-- タイトルと凡例 -->
<div id="info">
  <div id="titleText">（ここに年月が入ります）</div>
  <div id="legend">★＝体力　●＝感情　＋＝知性</div>
</div>

<canvas id="biorhythm"></canvas>

<table id="calendar"></table>

<script>
// -----------------------------
// 印刷機能
// -----------------------------
function printPage() {
  window.print();
}

// -----------------------------
// バイオリズム計算
// -----------------------------
function biorhythm(birth, target, cycle) {
  const diff = (target - birth) / (1000 * 60 * 60 * 24);
  return Math.sin((2 * Math.PI * diff) / cycle);
}

// -----------------------------
// バイオリズム描画（記号で表示）
// -----------------------------
function drawBiorhythm(birthDate, year, month) {
  const canvas = document.getElementById("biorhythm");
  const ctx = canvas.getContext("2d");

  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;

  const w = canvas.width;
  const h = canvas.height;

  const days = new Date(year, month, 0).getDate();

  ctx.clearRect(0, 0, w, h);

  // 左右余白
  const margin = 20;
  const graphWidth = w - margin * 2;

  // 日付目盛り
  ctx.fillStyle = "#000";
  ctx.font = "12px sans-serif";
  for (let d = 1; d <= days; d++) {
    const x = margin + (d - 1) * (graphWidth / (days - 1));
    if (d % 2 === 1) ctx.fillText(d, x - 3, 12);
  }

  // 記号で波形を描く
  const cycles = [
    { cycle: 23, mark: "★" },
    { cycle: 28, mark: "●" },
    { cycle: 33, mark: "＋" }
  ];

  ctx.font = "16px sans-serif";

  cycles.forEach(c => {
    for (let d = 1; d <= days; d++) {
      const x = margin + (d - 1) * (graphWidth / (days - 1));
      const date = new Date(year, month - 1, d);
      const yValue = biorhythm(birthDate, date, c.cycle);
      const y = h / 2 - yValue * (h / 2 - 20);

      ctx.fillText(c.mark, x - 5, y + 5);
    }
  });

  // 中央線
  ctx.strokeStyle = "#666";
  ctx.beginPath();
  ctx.moveTo(margin, h / 2);
  ctx.lineTo(w - margin, h / 2);
  ctx.stroke();
}

// -----------------------------
// カレンダー生成
// -----------------------------
function generateCalendar(year, month) {
  const table = document.getElementById("calendar");
  table.innerHTML = "";

  const days = ["日", "月", "火", "水", "木", "金", "土"];
  let header = "<tr>";
  days.forEach(d => header += `<th>${d}</th>`);
  header += "</tr>";
  table.innerHTML += header;

  const firstDay = new Date(year, month - 1, 1).getDay();
  const lastDate = new Date(year, month, 0).getDate();

  let row = "<tr>";
  for (let i = 0; i < firstDay; i++) row += "<td></td>";

  for (let d = 1; d <= lastDate; d++) {
    row += `<td><div class="date-number">${d}</div><textarea></textarea></td>`;
    if ((firstDay + d) % 7 === 0) {
      row += "</tr>";
      table.innerHTML += row;
      row = "<tr>";
    }
  }

  if (row !== "<tr>") {
    while (row.split("<td>").length - 1 < 7) row += "<td></td>";
    row += "</tr>";
    table.innerHTML += row;
  }
}

// -----------------------------
// 全体更新
// -----------------------------
function updateAll() {
  const birth = document.getElementById("birth").value;
  const year = Number(document.getElementById("year").value);
  const month = Number(document.getElementById("month").value);

  if (!birth) return alert("生年月日を入力してください");

  const birthDate = new Date(birth);

  // タイトル更新
  document.getElementById("titleText").textContent =
    `${year}年 ${month}月 バイオリズムカレンダー`;

  drawBiorhythm(birthDate, year, month);
  generateCalendar(year, month);
}
</script>

</body>
</html>
